import{s as i}from"./main-CXmArxYQ.js";const a=()=>{let r=localStorage.getItem("device_id");if(!r){const e=document.createElement("canvas"),o=e.getContext("2d");o==null||o.fillText("device-fingerprint",2,2);const c=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");let t=0;for(let n=0;n<c.length;n++){const s=c.charCodeAt(n);t=(t<<5)-t+s,t=t&t}r=`device-${Math.abs(t).toString(36)}-${Date.now().toString(36)}`,localStorage.setItem("device_id",r)}return r},d={getDeviceId:a,registerDevice:async r=>{const e=a(),o=navigator.userAgent,c=new Date().toISOString();try{const{data:t,error:n}=await i.from("devices").upsert({id:e,user_id:r,last_login_at:r?c:null,user_agent:o,updated_at:c},{onConflict:"id"}).select().single();return n?(console.error("Error registering device:",n),null):(console.log("✅ Device registered:",e,"for user:",r),t)}catch(t){return console.error("Failed to register device:",t),null}},getCurrentDevice:async()=>{const r=a();try{const{data:e,error:o}=await i.from("devices").select("*").eq("id",r).single();return o||!e?null:e}catch(e){return console.error("Failed to get device:",e),null}},clearDevice:async()=>{const r=a();try{await i.from("devices").update({user_id:null,updated_at:new Date().toISOString()}).eq("id",r),console.log("✅ Device cleared for logout")}catch(e){console.error("Failed to clear device:",e)}},getUserDevices:async r=>{try{const{data:e,error:o}=await i.from("devices").select("*").eq("user_id",r).order("last_login_at",{ascending:!1});return o?(console.error("Error fetching user devices:",o),[]):e||[]}catch(e){return console.error("Failed to get user devices:",e),[]}}};export{d as DeviceService};
